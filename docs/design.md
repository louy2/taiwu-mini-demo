# 设计文档

## 核心概念

### 界面设计：极简夜读 MUD 风格
为了提供沉浸式的文本体验，界面采用“夜读模式”设计。

1.  **布局结构**:
    *   **顶部状态栏 (Top Status)**: 固定高度，仅占用 2 行。
        *   *非战斗状态*: 密集显示角色核心属性（名称, 真气, 简略攻防数值）。
        *   *战斗状态*: 切换显示双方生命状态 (HP) 及核心战斗资源。
    *   **中央日志区 (Main Log)**: 占据屏幕绝大部分空间，显示滚动的事件日志。
    *   **底部抽屉 (Bottom Drawer)**:
        *   默认折叠，只保留极小的唤起按钮/把手。
        *   展开后显示：详细属性面板、**产业管理 (Estate)**、功法装备栏、真气分配控制、主要行动指令（战斗、修炼等）。

2.  **交互设计**:
    *   **战报链接**: 战斗结束的日志条目包含 `reportId`，点击即可弹出详细战报窗口。
    *   **字体**: 强制使用无衬线字体 (Microsoft YaHei, PingFang SC) 以提升阅读体验。
    *   **视觉**: 深色背景 (`#1a1a1a`)，高对比度文字，去除去 unnecessary 的边框和装饰，依靠排版区分层级。

### 属性
1.  **基础属性** (6组12项，初始值 50-60):
    | 攻击属性 | 防御属性 | 说明 |
    | :--- | :--- | :--- |
    | 力道 | 卸力 | 命中/化解 |
    | 精妙 | 拆招 | 命中/化解 |
    | 迅疾 | 闪避 | 命中/化解 |
    | 动心 | 守心 | 命中/化解 |
    | 破体 | 御体 | 外伤计算 |
    | 破气 | 御气 | 内伤计算 |

2.  **真气 (Qi)**:
    *   初始值 80，最大值 280。
    *   可以通过"运转周天"提升真气上限。
    *   真气可分配为 4 种类型:
        *   **摧破**: 强化攻击属性 (偏精妙)
        *   **轻灵**: 攻防兼备，强化力道和破气
        *   **护体**: 强化防御属性 (偏闪避)
        *   **奇窍**: 攻防兼备，强化迅疾和破体
    *   **便捷分配**:
        *   **全部分配**: 可将剩余可用真气一次性全部分配给某种类型。
        *   **平均分配**: 将剩余可用真气平均分配给4种类型。
        *   **重置**: 一键重置所有已分配真气，退回可用池。

3.  **内力类型 (Neili Type)**:
    *   可选类型：金刚、紫霞、玄阴、纯阳、归元、混元。
    *   影响真气分配时的属性加成倍率 (表1):

| 类型 | 力道/卸力 | 精妙/拆招 | 迅疾/闪避 | 动心/守心 | 破体/御体 | 破气/御气 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: |
| **金刚** | 5 | 2 | 2 | 3 | 8 | 2 |
| **紫霞** | 2 | 3 | 5 | 2 | 3 | 7 |
| **玄阴** | 2 | 2 | 3 | 5 | 2 | 8 |
| **纯阳** | 3 | 3 | 3 | 3 | 5 | 5 |
| **归元** | 3 | 5 | 2 | 2 | 7 | 3 |
| **混元** | 3 | 3 | 3 | 3 | 5 | 5 |

4.  **真气分配类型效果** (表2):

| 类型 | 力道 | 精妙 | 迅疾 | 动心 | 破体 | 破气 | 卸力 | 拆招 | 闪避 | 守心 | 御体 | 御气 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **摧破** | 1 | 6 | 3 | 3 | 1 | 1 | - | - | - | - | - | - |
| **轻灵** | 6 | 3 | 1 | 3 | 3 | 6 | 3 | 6 | 1 | 3 | 3 | 6 |
| **护体** | - | - | - | - | - | - | 1 | 3 | 6 | 3 | 1 | 1 |
| **奇窍** | 3 | 1 | 6 | 3 | 6 | 3 | 6 | 1 | 3 | 3 | 6 | 3 |

5.  **衍生效能**:
    *   **最终属性** = 基础属性 + 内力倍率 × Σ(真气分配 × 真气类型加成) + 装备加成

### 产业系统 (Estate & Currency)

1.  **资源**:
    *   **金钱 (Money)**: 来源于市集产出。用于抽取装备、扩建市集。
    *   **威望 (Prestige)**: 来源于祠堂产出。用于访名师(抽取功法)、修缮祠堂。

2.  **建筑与月份流转**:
    *   **市集**: 等级决定每月金钱产出。
    *   **祠堂**: 等级决定每月威望产出。
    *   **月份流转**: 每次进行“运转周天”操作时，视为时间流逝一个月，自动产出对应资源。

3.  **升级**:
    *   市集升级消耗金钱。
    *   祠堂升级消耗威望。

### 物品与装备 (Items & Gear)

1.  **装备槽位**:
    *   **武器 (Weapon)**: 增加 力道、破体、破气。
    *   **护甲 (Armor)**: 增加 卸力、御体、御气。
2.  **获取**:
    *   消耗 **金钱** 在市集“淘装备”获得随机装备。
3.  **装备逻辑**:
    *   新获得的装备放入背包。
    *   在“状态”面板点击装备槽即可更换装备。

### 功法系统 (Kung Fu)

1.  **内功 (Internal)**:
    *   决定人物的 **内力类型**。
    *   决定 **催破功法** 和 **护体功法** 的装备槽位数量。
    *   必须装备并在“运转周天”后生效。
2.  **催破功法 (Destruction Skills)**:
    *   战斗中自动施展的攻击招式。
    *   消耗 **势**。
    *   效果：提升当次攻击的属性倍率（如力道+20%）。
3.  **护体功法 (Protection Skills)**:
    *   受到攻击时自动施展的防御招式。
    *   消耗 **提气**。
    *   效果：百分比减少受到的伤害。
4.  **获取方式**:
    *   消耗 **威望** 进行“访名师”随机领悟。

### 战斗资源

1.  **势 (Shi)**:
    *   普通攻击命中时获得 1 点。
    *   用于施展催破功法。
2.  **提气 (TiQi)**:
    *   上限 30000。
    *   战斗中每秒恢复 1200 点。
    *   用于施展护体功法。

### 战斗机制

#### 1. 命中判定
根据双方 **最终力道** 与 **最终卸力** 的对比：
*   **当 进攻方力道 > 防守方卸力 时**：
    $$ 命中率 = \frac{进攻方力道}{防守方卸力} $$
*   **当 进攻方力道 \le 防守方卸力 时**：
    $$ 命中率 = \frac{\frac{进攻方力道}{防守方卸力}}{2} $$

#### 2. 伤害计算
攻击命中后，计算实际伤害。伤害分为 **外伤** 和 **内伤** 两部分，由攻击方设定的比例决定。
*   **基础伤害 (Base Damage)**: 固定为 9。
*   **内伤比例 (Internal Ratio)**: $R_{int}$ (0% - 100%)。
*   **外伤比例 (External Ratio)**: $R_{ext} = 1 - R_{int}$。

**外伤部分**:
*   系数 $x_{ext} = \frac{进攻方破体}{防守方御体}$
*   衰减 $y_{ext} = \frac{12.51}{12.51 + x_{ext}}$
*   $伤害_{ext} = 9 \times R_{ext} \times x_{ext} \times y_{ext}$

**内伤部分**:
*   系数 $x_{int} = \frac{进攻方破气}{防守方御气}$
*   衰减 $y_{int} = \frac{12.51}{12.51 + x_{int}}$
*   $伤害_{int} = 9 \times R_{int} \times x_{int} \times y_{int}$

**最终伤害**:
$$ 总伤害 = 伤害_{ext} + 伤害_{int} $$

#### 3. 受伤标记 (Injury Marks)
*   每当 **累积伤害 \ge 身心强健 (200)** 时：
    1.  受击方增加 1 个 **受伤标记**。
    2.  累积伤害减去 200。
*   **失败条件**: 累计获得 12 个受伤标记。

### 界面与系统
*   **存档管理**: 支持 3 个角色存档，支持删除。旧版本存档自动迁移。
*   **视觉风格**: 极简夜读风 (Dark Mode)，优化移动端阅读体验。
*   **战斗日志**: 实时滚动显示最近 3 条战斗记录，详细战报保留最近 10 场。
